<!DOCTYPE html><!--[if lte IE 8]>
<html lang="en" class="lte-ie8">
<![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en">
<!--<![endif]--><head><meta charset="utf-8"><title>December 27, 2015</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/diary/styles/global.css"><link rel="stylesheet" href="/diary/styles/tomorrow.css"><link rel="stylesheet" href="/diary/styles/diary.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63818301-1', 'auto');
ga('send', 'pageview');</script></head><body><header class="header"><div class="index"><a href="/diary/">Index</a></div><h1>December 27, 2015</h1></header><div class="content"><div class="diary"><h2 id="koa">Koa</h2>
<ul>
<li><p>Koa router can&#39;t handle calling <code>routes()</code> multiple times. Got to construct a new router every time.</p>
<p>Like this</p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nestedRouter</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> router = <span class="hljs-keyword">new</span> Router();
  router.use(...);
  <span class="hljs-keyword">return</span> router;
}

<span class="hljs-keyword">var</span> outerRouter1 = <span class="hljs-keyword">new</span> Router();
<span class="hljs-keyword">var</span> outerRouter2 = <span class="hljs-keyword">new</span> Router();

outerRouter1.use(nestedRouter().routes());
outerRouter2.use(nestedRouter().routes());
</code></pre>
</li>
<li>Koa-component@3.0 has <a href="https://github.com/koajs/compose/issues/35">breaking changes</a>.</li>
<li>When using muk to mock the dependencies, modify require cache in <code>brefore</code> hook, then restore in <code>after</code> hook.<ul>
<li>It doesn&#39;t mock things deep down the require chain, you need to directly modify the module required in your tested module, instead of modify the module that is required by that required module</li>
</ul>
</li>
</ul>
</div></div><footer class="footer"><address class="author">Copyright &copy;<a rel="author" href="https://github.com/joyeecheung" class="author-name">Joyee Cheung</a>-<a href="https://github.com/joyeecheung/my-tech-diary" class="source-repo">Source</a></address><p>Generated by<a href="https://github.com/joyeecheung/diary" class="site-repo">Joyee Cheung&#39;s diary generator</a></p></footer></body></html>